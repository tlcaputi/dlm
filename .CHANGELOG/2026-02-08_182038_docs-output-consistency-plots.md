# 2026-02-08 18:20 — Documentation Output Consistency & Plots Everywhere

## Summary

Systematic audit and fix of all documentation pages. Every output shown in the docs is now generated by running the exact code displayed on that page. Added R and Stata output, plots, and programmatic access examples to pages that were missing them.

## Problem

The documentation had several categories of issues:

1. **Fake placeholder values** — `r/guide.md` showed `0.1234567, 0.4567890` as beta coefficients (obviously fabricated, not from any real execution).
2. **Wrong language output** — The worked example's Stata output sections showed R's coefficient values. Since R and Stata have different RNGs, `seed(42)` produces different data in each language. The Stata output was incorrect.
3. **Broken code** — The worked example's Stata Step 4 (comparison) used `_b[es_m3]` to access event-study coefficients, but `dlm` overwrites `e(b)` when it runs in Step 3, so `_b[]` from the earlier `reghdfe` is gone. The code literally didn't work.
4. **Missing output** — The quickstart page showed no R output at all (only Stata). Neither guide page showed plot images.
5. **Misleading aggregation section** — The R guide had an "Aggregate treatment effects" section with `mean(mod$betas$coef[...])` that was meaningless.

## Approach

1. Ran R to generate all outputs: `str(df)`, `mod$betas`, `es$betas`, comparison table, `names(mod)`, `nobs()`, plots
2. Ran Stata to generate all outputs: `describe`, DLM display, `matrix list e(betas)`, `matrix list e(gamma)`, scalars, plot
3. Replaced every output block in every doc page with the actual output from these runs
4. Generated 5 new plot images from actual code execution
5. Built and deployed with `mkdocs build --strict`

## Changes Made

### Fixed: `docs/r/guide.md`
- Replaced fake `0.1234567` values with real output from `generate_data(seed=42, n_groups=500, n_times=20, treat_prob=0.4)`
- Added output table after "Basic estimation" example
- Added default `mod$plot` image and customized plot image
- Removed "Aggregate treatment effects" section (meaningless `mean()` of betas)

### Fixed: `docs/getting-started/worked-example.md`
- **Step 2 Stata output**: Changed from R's numbers to actual Stata `reghdfe` output format and coefficients
- **Step 2 Stata code**: Added `matrix es_b = e(b)` to save ES betas before `dlm` overwrites them
- **Step 3 Stata output**: Changed to actual Stata DLM output numbers
- **Step 4 Stata code**: Changed `_b[es_m3]` → `es_b[1, col]` (fixes broken code)
- **Step 4 Stata output**: Changed `0.00e+00` → actual `~1e-13` differences
- Added note about R/Stata RNG difference

### Rewritten: `docs/getting-started/quickstart.md`
Complete rewrite adding output for both languages:
- **Generate Data**: R `str(df)` output, Stata `describe` output
- **Estimate DLM**: R `mod$betas` table, Stata full DLM display
- **Plot the Results**: NEW section with `mod$plot` image (R) and `twoway` plot image (Stata)
- **Access Results Programmatically**: R output (`mod$betas` values, `nobs()`), Stata output (`matrix list e(betas)`, `matrix list e(gamma)`, scalars)
- Added RNG difference note

### Updated: `docs/stata/guide.md`
- Added DLM output table after "Basic estimation" example
- Added event-study plot image after plot code

### New plot images in `docs/assets/`
| File | Source | Shows |
|------|--------|-------|
| `plot_quickstart_r.png` | `mod$plot` in R | R built-in event-study plot |
| `plot_quickstart_stata.png` | `twoway` in Stata | Stata event-study plot |
| `plot_r_guide_default.png` | `mod$plot` in R | Default R plot for guide |
| `plot_r_guide_custom.png` | `mod$plot + labs() + theme_minimal()` | Customized R plot |
| `plot_stata_guide.png` | `twoway` in Stata | Stata plot for guide |

### Verified unchanged (already correct)
- `docs/index.md` — No code output shown
- `docs/getting-started/installation.md` — No code output shown
- `docs/r/api.md` — No code output shown
- `docs/stata/api.md` — No code output shown
- `docs/theory/background.md` — Mathematical notation only

## Verification Method

Every output was generated by running the exact code shown in the docs:

```bash
# R verification
Rscript -e '...exact code from docs...'

# Stata verification
echo '...exact code from docs...' > /tmp/verify.do
/Applications/Stata/StataSE.app/Contents/MacOS/stata-se -b do /tmp/verify.do
cat /tmp/verify.log
```

## Key Principle Established

**No fake results anywhere.** All documentation output must be reproducible by the user running the exact code shown. The seed, parameters, and code must produce exactly the numbers displayed.

## Deployment

All changes deployed to:
- `https://tlcaputi.github.io/dlm/` via `ghp-import` to `gh-pages` branch
- Source committed to `main` branch of `tlcaputi/dlm`

## Files Affected

| File | Change |
|------|--------|
| `docs/getting-started/quickstart.md` | Complete rewrite with R+Stata output and plots |
| `docs/getting-started/worked-example.md` | Fixed Stata output, broken code, comparison values |
| `docs/r/guide.md` | Fixed fake values, added output+plots, removed aggregation section |
| `docs/stata/guide.md` | Added DLM output, plot image |
| `docs/assets/plot_quickstart_r.png` | New |
| `docs/assets/plot_quickstart_stata.png` | New |
| `docs/assets/plot_r_guide_default.png` | New |
| `docs/assets/plot_r_guide_custom.png` | New |
| `docs/assets/plot_stata_guide.png` | New |
