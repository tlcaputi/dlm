{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"dlm \u2014 Distributed Lag Models","text":"<p>Implementations of the distributed lag model (DLM) framework from Schmidheiny and Siegloch (2023, Journal of Applied Econometrics) for R and Stata.</p> <p>DLMs generalize the canonical event study to settings with continuous treatments that can change in magnitude, sign, and timing throughout the study period. When applied to a binary treatment, the DLM produces estimates that are numerically identical to a binned-endpoint event study.</p>"},{"location":"#why-dlms","title":"Why DLMs?","text":"<p>The canonical event study uses event-time indicator variables (dummies), which only make sense when treatment is a one-time binary switch. But many empirical settings involve continuous treatments \u2014 tax rates that change by different amounts across states, minimum wages that increase and decrease at varying magnitudes over time, policy shocks of different sizes hitting different units at different times. In these settings, event-time dummies don't apply. Researchers are often forced to dichotomize continuous treatments into \"big changes\" versus no change, which fundamentally alters the analysis by discarding variation and potentially biasing estimates.</p> <p>The DLM solves this by replacing event-time dummies with leads and lags of the treatment variable itself. Because it operates on the treatment variable directly, it naturally handles treatments that are continuous, change sign, vary in magnitude, and occur multiple times per unit.</p> <p>Key properties:</p> <ul> <li>Generalizes event studies to continuous treatments. The DLM can produce event-study-style dynamic treatment effect plots for treatments that increase and decrease at different magnitudes over many time periods \u2014 something canonical event studies simply cannot do.</li> <li>Equivalent to binned event studies for binary treatments. When applied to the special case of a binary absorbing treatment, the DLM produces betas that are numerically identical to a properly specified event study with binned endpoints. The DLM is therefore a strict generalization of the canonical event study (see Theory).</li> <li>More data hungry than canonical event studies. The DLM requires observing the treatment variable over a wider window than the outcome. Leads and lags at panel edges create missing values that reduce the estimation sample, so wider event windows require substantially more data.</li> </ul>"},{"location":"#how-it-works","title":"How It Works","text":"<ol> <li>Regresses the outcome on leads and lags of the treatment variable \u2192 produces gamma (\u03b3) coefficients measuring incremental treatment effects</li> <li>Transforms gammas into cumulative beta (\u03b2) coefficients via cumulative summation</li> <li>Propagates standard errors correctly through the variance-covariance matrix</li> </ol> <p>The resulting betas have the same interpretation as event-study coefficients: dynamic treatment effects at each time horizon relative to the reference period.</p>"},{"location":"#quick-example","title":"Quick Example","text":"RStata <pre><code># Install\ndevtools::install_github(\"tlcaputi/dlm\")\n\n# Estimate\nlibrary(dlm)\nmod &lt;- distributed_lags_model(\n  data = outcome_data,\n  exposure_data = treatment_data,\n  from_rt = -3, to_rt = 3,\n  outcome = \"outcome\", exposure = \"treated\",\n  unit = \"id\", time = \"year\"\n)\n\n# View results\nmod$betas\nmod$plot\n</code></pre> <pre><code>* Install\nnet install dlm, from(\"https://raw.githubusercontent.com/tlcaputi/dlm-stata/main/\")\n\n* Estimate\ndlm outcome, exposure(treated) unit(id) time(year) from(-3) to(3)\n\n* View results\nmatrix list e(betas)\n</code></pre>"},{"location":"#features","title":"Features","text":"Feature R Stata High-dimensional FE (unit + time) fixest reghdfe Clustered SEs Unit-level Unit-level Additional covariates \u2713 \u2713 Additional fixed effects \u2713 \u2713 Custom reference period \u2713 \u2713 Event-study plot Built-in Via <code>e(betas)</code> matrix Multiple outcomes per call \u2713 Loop externally Weighted regression \u2713 \u2014"},{"location":"#links","title":"Links","text":"R package github.com/tlcaputi/dlm Stata package github.com/tlcaputi/dlm-stata"},{"location":"#developer","title":"Developer","text":"Theodore Caputi     MIT Department of Economics"},{"location":"#citation-and-acknowledgment","title":"Citation and Acknowledgment","text":"<p>These packages implement the distributed lag model method introduced by Schmidheiny and Siegloch (2023) and borrow in part from their replication code. The packages themselves \u2014 including all bugs and design decisions \u2014 are by Theodore Caputi and are not affiliated with or endorsed by the original authors.</p> <p>If you use the underlying method, please cite the original paper:</p> <p>Schmidheiny, K. and S. Siegloch (2023). \"On event studies and distributed-lag models: Equivalence, generalization and practical implications.\" Journal of Applied Econometrics, 38(5): 695\u2013713.</p>"},{"location":"CURRENT_STATE/","title":"dlm Package \u2014 Current State","text":"<p>Last updated: 2026-02-08 18:20 ET</p>"},{"location":"CURRENT_STATE/#overview","title":"Overview","text":"<p>The <code>dlm</code> package implements distributed lag models (Schmidheiny &amp; Siegloch 2023, JAE) in both R and Stata. It is fully functional, tested, documented, and deployed.</p>"},{"location":"CURRENT_STATE/#repositories","title":"Repositories","text":"Repo URL Branch R package + docs source <code>github.com/tlcaputi/dlm</code> <code>main</code> Stata package <code>github.com/tlcaputi/dlm-stata</code> <code>main</code> Docs deployment <code>github.com/tlcaputi/dlm</code> <code>gh-pages</code> Personal website <code>github.com/tlcaputi/tlcaputi.github.io</code> <code>master</code>"},{"location":"CURRENT_STATE/#local-file-locations","title":"Local File Locations","text":"What Path Package source (R + Stata + docs) <code>/Users/theo/DropboxMIT/packages/dlm/</code> R package code <code>/Users/theo/DropboxMIT/packages/dlm/r/</code> Stata package code <code>/Users/theo/DropboxMIT/packages/dlm/stata/</code> MkDocs source <code>/Users/theo/DropboxMIT/packages/dlm/docs/</code> + <code>mkdocs.yml</code> Deploy working copy <code>/tmp/dlm-docs-deploy/</code> (clone of tlcaputi/dlm, main branch) Personal website source <code>/Users/theo/MIT Dropbox/Theodore Caputi/job-market/gh-website/</code> <p>Important: <code>/tmp/dlm-docs-deploy/</code> is ephemeral. If it doesn't exist, re-clone: <pre><code>cd /tmp &amp;&amp; git clone https://github.com/tlcaputi/dlm.git dlm-docs-deploy\n</code></pre></p>"},{"location":"CURRENT_STATE/#build-and-deploy-commands","title":"Build and Deploy Commands","text":"<pre><code># Build docs\ncd /tmp/dlm-docs-deploy\n~/.pyenv/versions/antipsychotics/bin/mkdocs build --strict\n\n# Deploy to gh-pages\n~/.pyenv/versions/antipsychotics/bin/ghp-import -n -p -f site\n\n# After editing source files in /Users/theo/DropboxMIT/packages/dlm/:\n# 1. Copy changed files to /tmp/dlm-docs-deploy/\n# 2. Build\n# 3. git add/commit/push (main branch)\n# 4. ghp-import (gh-pages branch)\n</code></pre>"},{"location":"CURRENT_STATE/#whats-working","title":"What's Working","text":""},{"location":"CURRENT_STATE/#r-package-devtoolsinstall_githubtlcaputidlm","title":"R Package (<code>devtools::install_github(\"tlcaputi/dlm\")</code>)","text":"<ul> <li><code>distributed_lags_model()</code> \u2014 single-outcome DLM estimation</li> <li><code>distributed_lags_models()</code> \u2014 multi-outcome batch estimation</li> <li><code>generate_data()</code> \u2014 test data generator</li> <li><code>standard_twfe_for_comparison()</code> \u2014 canonical binned-endpoint event study</li> <li>Built-in event-study plot via <code>mod$plot</code> (ggplot2 object)</li> <li>All tests passing (28/28 doc examples + worked example + equivalence test)</li> </ul>"},{"location":"CURRENT_STATE/#stata-package-net-install-dlm-from","title":"Stata Package (<code>net install dlm, from(...)</code>)","text":"<ul> <li><code>dlm</code> command \u2014 single-outcome DLM estimation</li> <li><code>dlm_gen_data</code> \u2014 test data generator</li> <li>Returns <code>e(betas)</code> matrix with coefficients, SEs, CIs</li> <li>All tests passing (18/18 doc examples + worked example + equivalence test)</li> <li>Requires <code>reghdfe</code> (<code>ssc install reghdfe</code>)</li> </ul>"},{"location":"CURRENT_STATE/#documentation-site-theodorecaputicomdlm","title":"Documentation Site (theodorecaputi.com/dlm/)","text":"<ul> <li>MkDocs Material theme with dark/light mode</li> <li>Pages: Home, Installation, Quick Start, Worked Example, R Guide, R API, Stata Guide, Stata API, Theory</li> <li>Custom SVG logo, headshot, 10 event-study plot images</li> <li>R shown before Stata everywhere (R is the \"default\" language)</li> <li>MkDocs footer hidden via custom CSS</li> <li>Every output shown is reproducible by running the exact code displayed</li> </ul>"},{"location":"CURRENT_STATE/#personal-website-theodorecaputicomsoftware","title":"Personal Website (theodorecaputi.com/#software)","text":"<ul> <li>Single <code>dlm</code> card with R + Stata badges</li> <li>Separate GitHub links and install commands for each language</li> <li>Documentation link to shared docs site</li> </ul>"},{"location":"CURRENT_STATE/#key-design-decisions","title":"Key Design Decisions","text":"<ol> <li> <p>aggr_es() removed from docs \u2014 It's a fixest utility bundled in the R package as a dependency of <code>ggiplot</code>/<code>iplot_data</code>, but it doesn't work with DLM model objects. Only works with fixest models estimated via <code>i()</code>.</p> </li> <li> <p>Attribution \u2014 The citation section explicitly states these packages are by Theodore Caputi, implement S&amp;S's method, borrow from their replication code, and are not affiliated with the original authors.</p> </li> <li> <p>Equivalence verification \u2014 Both R and Stata implementations produce coefficients matching a canonical binned-endpoint event study to machine precision (~1e-15 in R, ~1e-13 in Stata).</p> </li> <li> <p>No plotting in Stata \u2014 Users construct plots manually from <code>e(betas)</code> matrix. The quickstart, worked example, and Stata guide all show how with actual plot images.</p> </li> <li> <p>No fake results \u2014 Every output block in every doc page was generated by running the exact code shown. All outputs verified 2026-02-08.</p> </li> <li> <p>RNG difference documented \u2014 R and Stata use different RNGs, so <code>seed(42)</code> produces different data. Each language shows its own correct output. A note explains this on the quickstart and worked example pages.</p> </li> </ol>"},{"location":"CURRENT_STATE/#known-issues-limitations","title":"Known Issues / Limitations","text":"<ul> <li>The R package exports some functions that are really fixest utilities (<code>aggr_es</code>, <code>ggiplot</code>, <code>iplot_data</code>). These are used internally but could confuse users. They've been removed from docs but are still exported in the NAMESPACE.</li> <li><code>standard_twfe_for_comparison()</code> requires <code>library(ggplot2)</code> to be loaded (it calls <code>ggiplot</code> internally which uses ggplot2 functions).</li> <li>Stata <code>dlm_gen_data</code> uses a different RNG than R's <code>generate_data()</code>, so the same seed produces different data. Cross-language equivalence is verified within each language, not across.</li> </ul>"},{"location":"CURRENT_STATE/#documentation-output-verification","title":"Documentation Output Verification","text":"<p>All output was verified by running:</p> <pre><code># R \u2014 all quickstart, guide, and worked example output\nRscript -e '...exact code from docs...'\n\n# Stata \u2014 all quickstart, guide, and worked example output\n# Write .do file, then:\n/Applications/Stata/StataSE.app/Contents/MacOS/stata-se -b do /tmp/verify.do\n</code></pre>"},{"location":"CURRENT_STATE/#r-output-parameters","title":"R output parameters","text":"<ul> <li><code>generate_data(seed = 42, n_groups = 500, n_times = 20, treat_prob = 0.4)</code></li> <li><code>distributed_lags_model(from_rt = -3, to_rt = 3, outcome = \"outcome\", exposure = \"post\", unit = \"group\", time = \"time\")</code></li> <li>R betas: \u22120.118, \u22120.063, \u22122.641, \u22122.260, \u22123.042, \u22122.618</li> </ul>"},{"location":"CURRENT_STATE/#stata-output-parameters","title":"Stata output parameters","text":"<ul> <li><code>dlm_gen_data, n_groups(500) n_times(20) treat_prob(0.4) seed(42) clear</code></li> <li><code>dlm outcome, exposure(post) unit(unit) time(time) from(-3) to(3)</code></li> <li>Stata betas: \u22120.064, 0.095, \u22122.764, \u22123.094, \u22122.708, \u22123.257</li> </ul>"},{"location":"CURRENT_STATE/#file-map","title":"File Map","text":"<pre><code>dlm/\n\u251c\u2500\u2500 r/                          # R package\n\u2502   \u251c\u2500\u2500 R/\n\u2502   \u2502   \u251c\u2500\u2500 dlm-functions.R     # Core: distributed_lags_model(), generate_data(), etc.\n\u2502   \u2502   \u251c\u2500\u2500 utils.R             # Helpers: revcumsum(), secumsum(), etc.\n\u2502   \u2502   \u251c\u2500\u2500 aggr_es.R           # fixest utility (NOT dlm-specific)\n\u2502   \u2502   \u251c\u2500\u2500 iplot_data.R        # fixest utility (NOT dlm-specific)\n\u2502   \u2502   \u251c\u2500\u2500 cpi-functions.R     # CPI/inflation adjustment utilities\n\u2502   \u2502   \u2514\u2500\u2500 data.R              # Data documentation\n\u2502   \u251c\u2500\u2500 man/                    # Rd help files\n\u2502   \u251c\u2500\u2500 DESCRIPTION\n\u2502   \u2514\u2500\u2500 NAMESPACE\n\u251c\u2500\u2500 stata/                      # Stata package\n\u2502   \u251c\u2500\u2500 dlm.ado                 # Main estimation command (includes Mata)\n\u2502   \u251c\u2500\u2500 dlm_gen_data.ado        # Test data generator\n\u2502   \u251c\u2500\u2500 dlm.sthlp               # Help file\n\u2502   \u251c\u2500\u2500 stata.toc               # Package index\n\u2502   \u251c\u2500\u2500 dlm.pkg                 # Package descriptor\n\u2502   \u251c\u2500\u2500 test_dlm_equivalence.do # Equivalence test\n\u2502   \u2514\u2500\u2500 test_cross_language.do  # Cross-language comparison\n\u251c\u2500\u2500 docs/                       # MkDocs source\n\u2502   \u251c\u2500\u2500 index.md                # Homepage\n\u2502   \u251c\u2500\u2500 getting-started/\n\u2502   \u2502   \u251c\u2500\u2500 installation.md\n\u2502   \u2502   \u251c\u2500\u2500 quickstart.md       # Full output for both R and Stata + plots\n\u2502   \u2502   \u2514\u2500\u2500 worked-example.md   # Full worked example with 3 comparison plots\n\u2502   \u251c\u2500\u2500 r/\n\u2502   \u2502   \u251c\u2500\u2500 guide.md            # Usage guide with output + 2 plot images\n\u2502   \u2502   \u2514\u2500\u2500 api.md\n\u2502   \u251c\u2500\u2500 stata/\n\u2502   \u2502   \u251c\u2500\u2500 guide.md            # Usage guide with output + plot image\n\u2502   \u2502   \u2514\u2500\u2500 api.md\n\u2502   \u251c\u2500\u2500 theory/\n\u2502   \u2502   \u2514\u2500\u2500 background.md       # Intuitive explanation + formal math\n\u2502   \u251c\u2500\u2500 assets/\n\u2502   \u2502   \u251c\u2500\u2500 logo.svg            # DLM logo\n\u2502   \u2502   \u251c\u2500\u2500 headshot.jpg        # Developer photo\n\u2502   \u2502   \u251c\u2500\u2500 plot_event_study.png      # Worked example: ES plot\n\u2502   \u2502   \u251c\u2500\u2500 plot_dlm.png              # Worked example: DLM plot\n\u2502   \u2502   \u251c\u2500\u2500 plot_combined.png         # Worked example: overlay plot\n\u2502   \u2502   \u251c\u2500\u2500 plot_quickstart_r.png     # Quickstart: R mod$plot\n\u2502   \u2502   \u251c\u2500\u2500 plot_quickstart_stata.png # Quickstart: Stata twoway\n\u2502   \u2502   \u251c\u2500\u2500 plot_r_guide_default.png  # R guide: default mod$plot\n\u2502   \u2502   \u251c\u2500\u2500 plot_r_guide_custom.png   # R guide: customized plot\n\u2502   \u2502   \u2514\u2500\u2500 plot_stata_guide.png      # Stata guide: twoway plot\n\u2502   \u2514\u2500\u2500 stylesheets/\n\u2502       \u2514\u2500\u2500 extra.css           # Hides MkDocs footer\n\u251c\u2500\u2500 mkdocs.yml                  # MkDocs config\n\u2514\u2500\u2500 .CHANGELOG/                 # Session changelogs\n</code></pre>"},{"location":"CURRENT_STATE/#test-commands","title":"Test Commands","text":"<pre><code># R tests\nRscript /Users/theo/DropboxMIT/packages/dlm/r/test_docs_examples.R\nRscript /Users/theo/DropboxMIT/packages/dlm/r/test_worked_example.R\n\n# Stata tests (requires Stata)\n/Applications/Stata/StataSE.app/Contents/MacOS/stata-se -b do /Users/theo/DropboxMIT/packages/dlm/stata/test_dlm_equivalence.do\n/Applications/Stata/StataSE.app/Contents/MacOS/stata-se -b do /Users/theo/DropboxMIT/packages/dlm/stata/test_worked_example.do\n\n# MkDocs strict build\ncd /tmp/dlm-docs-deploy &amp;&amp; ~/.pyenv/versions/antipsychotics/bin/mkdocs build --strict\n</code></pre>"},{"location":"CURRENT_STATE/#changelogs","title":"Changelogs","text":"Date File Summary 2026-02-08 16:27 <code>2026-02-08_162738_docs-plots-attribution-website.md</code> Initial docs: plots, attribution, GitHub links, headshot, website update 2026-02-08 18:20 <code>2026-02-08_182038_docs-output-consistency-plots.md</code> Output consistency: fixed fake values, wrong Stata output, broken code, added R+Stata output and plots to all pages"},{"location":"getting-started/installation/","title":"Installation","text":""},{"location":"getting-started/installation/#r","title":"R","text":""},{"location":"getting-started/installation/#from-github","title":"From GitHub","text":"<pre><code># install.packages(\"devtools\")  # if needed\ndevtools::install_github(\"tlcaputi/dlm\")\n</code></pre>"},{"location":"getting-started/installation/#prerequisites","title":"Prerequisites","text":"<p>The R package requires:</p> <ul> <li>R 4.0+</li> <li>fixest \u2014 installed automatically as a dependency</li> <li>dplyr, ggplot2, glue, logger, scales \u2014 installed automatically</li> </ul>"},{"location":"getting-started/installation/#verify-installation","title":"Verify installation","text":"<pre><code>library(dlm)\n?distributed_lags_model\n</code></pre>"},{"location":"getting-started/installation/#stata","title":"Stata","text":""},{"location":"getting-started/installation/#from-github-recommended","title":"From GitHub (recommended)","text":"<pre><code>net install dlm, from(\"https://raw.githubusercontent.com/tlcaputi/dlm-stata/main/\")\n</code></pre> <p>This installs <code>dlm.ado</code>, <code>dlm_gen_data.ado</code>, and the help file.</p>"},{"location":"getting-started/installation/#prerequisites_1","title":"Prerequisites","text":"<p>The Stata package requires:</p> <ul> <li>Stata 15 or later</li> <li>reghdfe \u2014 install with <code>ssc install reghdfe</code></li> </ul>"},{"location":"getting-started/installation/#verify-installation_1","title":"Verify installation","text":"<pre><code>which dlm\nhelp dlm\n</code></pre>"},{"location":"getting-started/installation/#uninstall","title":"Uninstall","text":"<pre><code>ado uninstall dlm\n</code></pre>"},{"location":"getting-started/quickstart/","title":"Quick Start","text":"<p>This page walks through a complete example in both R and Stata using generated test data. Both packages include a built-in test dataset generator so you can try the package immediately and verify that the DLM produces estimates identical to a canonical event study with binned endpoints.</p>"},{"location":"getting-started/quickstart/#generate-test-data","title":"Generate Test Data","text":"<p>Both packages include a data generator that creates a balanced panel with staggered treatment adoption. The generated data has:</p> <ul> <li>A configurable number of units and time periods</li> <li>Treatment assigned randomly to a fraction of units</li> <li>Treatment onset at time 7, 8, or 9 (uniform)</li> <li>A treatment effect of \u22123 on the outcome (post-treatment)</li> <li>Gaussian noise (\u03c3 = 5)</li> </ul> RStata <pre><code>library(dlm)\ndf &lt;- generate_data(seed = 42, n_groups = 500, n_times = 20, treat_prob = 0.4)\nstr(df)\n</code></pre> <p>Output:</p> <pre><code>'data.frame':   10000 obs. of  7 variables:\n $ group             : Factor w/ 500 levels \"group1\",\"group2\",..: 1 1 1 1 1 ...\n $ time              : int  1 2 3 4 5 6 7 8 9 10 ...\n $ treatment_time    : int  7 7 7 7 7 7 7 7 7 7 ...\n $ treat             : num  1 1 1 1 1 1 1 1 1 1 ...\n $ years_to_treatment: num  -6 -5 -4 -3 -2 -1 0 1 2 3 ...\n $ post              : num  0 0 0 0 0 0 1 1 1 1 ...\n $ outcome           : num  -4.68 3.52 2.48 8.83 -2.54 ...\n</code></pre> <pre><code>dlm_gen_data, n_groups(500) n_times(20) treat_prob(0.4) seed(42) clear\ndescribe\n</code></pre> <p>Output:</p> <pre><code>Generated balanced panel:\n  Units:          500\n  Time periods:   20\n  Total obs:      10000\n  Treated units:  195 (39%)\n  Treatment time: uniformly in {7, 8, 9}\n  Treatment effect: -3 (post-treatment)\n\nContains data\n Observations:        10,000\n    Variables:             7\n---------------------------------------------------------------\nVariable      Storage   Display    Value\n    name         type    format    label      Variable label\n---------------------------------------------------------------\nunit            long    %12.0g                Unit identifier\ntime            long    %12.0g                Time period\ntreat           byte    %8.0g                 Treatment group indicator\ntreatment_time  long    %12.0g                Period when treatment begins\nyears_to_trea~t long    %12.0g                Periods relative to treatment\n                                                (-1000 = never treated)\npost            byte    %8.0g                 Post-treatment indicator\noutcome         double  %10.0g                Outcome (noise + treatment\n                                                effect)\n---------------------------------------------------------------\nSorted by: unit  time\n</code></pre> <p>Note</p> <p>R and Stata use different random number generators, so <code>seed = 42</code> produces different data in each language. The coefficients differ numerically but the DLM works identically in both.</p>"},{"location":"getting-started/quickstart/#estimate-the-dlm","title":"Estimate the DLM","text":"RStata <pre><code>library(dlm)\nlibrary(dplyr)\n\ndf &lt;- generate_data(seed = 42, n_groups = 500, n_times = 20, treat_prob = 0.4)\n\noutcome_data &lt;- df %&gt;% select(group, time, outcome)\nexposure_data &lt;- df %&gt;% select(group, time, post) %&gt;% distinct()\n\nmod &lt;- distributed_lags_model(\n  data = outcome_data,\n  exposure_data = exposure_data,\n  from_rt = -3, to_rt = 3,\n  outcome = \"outcome\", exposure = \"post\",\n  unit = \"group\", time = \"time\"\n)\n\nmod$betas\n</code></pre> <p>Output:</p> <pre><code>           time_to_event        coef        se\npost_lead2            -3 -0.11846256 0.4729260\npost_lead1            -2 -0.06327287 0.5139965\npost_lag0              0 -2.64104056 0.5438700\npost_lag1              1 -2.26029265 0.5234023\npost_lag2              2 -3.04210098 0.5674556\npost_lag3              3 -2.61751913 0.4214689\n</code></pre> <pre><code>dlm outcome, exposure(post) unit(unit) time(time) from(-3) to(3)\n</code></pre> <p>Output:</p> <pre><code>------------------------------------------------------------------------\nDistributed Lag Model (Schmidheiny &amp; Siegloch 2023)\n------------------------------------------------------------------------\n  Outcome:    outcome\n  Exposure:   post\n  Window:     [-3, 3], ref = -1\n  N obs:      7500\n  N clusters: 500\n------------------------------------------------------------------------\n\n        Time        Coef          SE     95% CI lo     95% CI hi\n------------------------------------------------------------------------\n          -3   -0.063959    0.483545     -1.011708      0.883790\n          -2    0.094669    0.480424     -0.846962      1.036299\n          -1       (ref)           .             .             .\n           0   -2.763973    0.461907     -3.669310     -1.858636\n           1   -3.094282    0.520414     -4.114294     -2.074271\n           2   -2.707691    0.554940     -3.795373     -1.620010\n           3   -3.256921    0.426200     -4.092272     -2.421569\n------------------------------------------------------------------------\n</code></pre>"},{"location":"getting-started/quickstart/#interpret-results","title":"Interpret Results","text":"<p>The output table shows beta coefficients \u2014 cumulative treatment effects at each event time relative to the reference period (default: \u22121).</p> <ul> <li>Pre-treatment betas (t &lt; ref): Should be near zero if parallel trends hold. These test the \"no pre-trend\" assumption.</li> <li>Post-treatment betas (t \u2265 0): Estimate the cumulative causal effect at each horizon.</li> <li>Reference period (t = \u22121): Normalized to zero by construction.</li> </ul> <p>In both examples, the true treatment effect is \u22123. The estimated post-treatment betas cluster around \u22123, while pre-treatment betas are close to zero \u2014 exactly as expected.</p> <p>Because the test data uses a binary absorbing treatment, these betas are numerically identical to what a canonical binned-endpoint event study would produce on the same data. Both the R and Stata packages include equivalence tests that verify this match to machine precision (~10\u207b\u00b9\u00b3).</p>"},{"location":"getting-started/quickstart/#plot-the-results","title":"Plot the Results","text":"RStata <p>The returned model object includes a ready-made event-study plot:</p> <pre><code>mod$plot\n</code></pre> <p></p> <p>After estimation, use <code>dlm_plot</code> for a publication-quality event study plot:</p> <pre><code>dlm_plot, title(\"Event-Study Plot (DLM)\") xtitle(\"Periods to Treatment\") ytitle(\"Coefficient\")\n</code></pre> <p></p>"},{"location":"getting-started/quickstart/#access-results-programmatically","title":"Access Results Programmatically","text":"RStata <pre><code># Beta coefficients (data.frame: time_to_event, coef, se)\nmod$betas\n#            time_to_event        coef        se\n# post_lead2            -3 -0.11846256 0.4729260\n# post_lead1            -2 -0.06327287 0.5139965\n# post_lag0              0 -2.64104056 0.5438700\n# post_lag1              1 -2.26029265 0.5234023\n# post_lag2              2 -3.04210098 0.5674556\n# post_lag3              3 -2.61751913 0.4214689\n\n# Event-study plot (ggplot2 object)\nmod$plot\n\n# Underlying fixest model object\nsummary(mod$model)\n\n# Gamma variance-covariance matrix\nmod$vcov\n\n# Number of observations\nnobs(mod$model)\n# [1] 7500\n</code></pre> <pre><code>* Beta coefficients (time, coef, se, ci_lo, ci_hi)\nmatrix list e(betas)\n</code></pre> <pre><code>e(betas)[7,5]\n    time_to_ev~t          coef            se         ci_lo         ci_hi\nr1            -3    -.06395882     .48354546    -1.0117079     .88379028\nr2            -2     .09466869     .48042378    -.84696192     1.0362993\nr3            -1             0             0             0             0\nr4             0    -2.7639728     .46190658    -3.6693097    -1.8586358\nr5             1    -3.0942824     .52041411    -4.1142941    -2.0742708\nr6             2    -2.7076914     .55493963    -3.7953731    -1.6200097\nr7             3    -3.2569205     .42619968    -4.0922719    -2.4215691\n</code></pre> <pre><code>* Raw gamma coefficients from the lead/lag regression\nmatrix list e(gamma)\n</code></pre> <pre><code>e(gamma)[1,6]\n    _dlm_lead2  _dlm_lead1   _dlm_lag0   _dlm_lag1   _dlm_lag2   _dlm_lag3\ny1    .1586275  -.09466869  -2.7639728  -.33030967   .38659102  -.54922912\n</code></pre> <pre><code>* Scalars\ndisplay e(N)          // number of observations\ndisplay e(N_clust)    // number of clusters\ndisplay e(from)       // from period\ndisplay e(to)         // to period\ndisplay e(ref_period) // reference period\n</code></pre> <pre><code>7500\n500\n-3\n3\n-1\n</code></pre>"},{"location":"getting-started/worked-example/","title":"Worked Example","text":"<p>This page walks through a complete analysis: we generate panel data, run both a canonical event study and a DLM, compare the results, and plot them. You can copy and paste the code directly into R or Stata.</p>"},{"location":"getting-started/worked-example/#the-setup","title":"The Setup","text":"<p>We generate a balanced panel of 500 units observed over 20 time periods. About 40% of units receive treatment starting at time 7, 8, or 9 (randomly drawn). The true treatment effect is \u22123: after treatment onset, the outcome drops by 3 units on average.</p> <p>Because treatment is binary and absorbing (turns on once and stays on), both the canonical event study and the DLM should produce identical estimates. This example demonstrates that.</p>"},{"location":"getting-started/worked-example/#step-1-generate-the-data","title":"Step 1: Generate the Data","text":"RStata <pre><code>library(dlm)\nlibrary(dplyr)\nlibrary(ggplot2)\n\n# Generate test data (true effect = -3)\ndf &lt;- generate_data(seed = 42, n_groups = 500, n_times = 20, treat_prob = 0.4)\n\n# Separate outcome and exposure data (required by the R interface)\noutcome_data &lt;- df %&gt;% select(group, time, outcome)\nexposure_data &lt;- df %&gt;% select(group, time, post) %&gt;% distinct()\n</code></pre> <pre><code>* Generate test data (true effect = -3)\ndlm_gen_data, n_groups(500) n_times(20) treat_prob(0.4) seed(42) clear\n</code></pre> <p>The generated data has columns <code>unit</code> (or <code>group</code>), <code>time</code>, <code>outcome</code>, <code>post</code> (binary treatment indicator), and <code>years_to_treatment</code> (event time, with \u22121000 for never-treated units).</p>"},{"location":"getting-started/worked-example/#step-2-run-the-canonical-event-study","title":"Step 2: Run the Canonical Event Study","text":"<p>First, we estimate a standard event study using binned-endpoint event-time dummies. This is the approach most researchers are familiar with: create dummy variables for each event-time period (e.g., \\(D_{-3}, D_{-2}, D_0, D_1, D_2, D_3\\)), omit the reference period (\\(t = -1\\)), and regress the outcome on these dummies with unit and time fixed effects.</p> <p>The endpoints are \"binned\" \u2014 the \\(D_{-3}\\) dummy equals 1 for all units at event time \\(-3\\) or earlier, and \\(D_3\\) equals 1 for all units at event time \\(3\\) or later.</p> RStata <pre><code># Run a binned-endpoint event study\nes &lt;- standard_twfe_for_comparison(\n  data = df,\n  from_rt = -3, to_rt = 3,\n  outcome = \"outcome\",\n  time = \"time\", unit = \"group\",\n  time_to_treatment = \"years_to_treatment\",\n  treat = \"treat\",\n  ref_period = -1\n)\n\n# Event-study coefficients\nes$betas\n#                                     coef        se       tval         pval\n# time_to_treatment::-3+:treat -0.11846256 0.4729260 -0.2504886 8.023126e-01\n# time_to_treatment::-2:treat  -0.06327287 0.5139965 -0.1230998 9.020776e-01\n# time_to_treatment::0:treat   -2.64104056 0.5438700 -4.8560142 1.605193e-06\n# time_to_treatment::1:treat   -2.26029265 0.5234023 -4.3184616 1.896217e-05\n# time_to_treatment::2:treat   -3.04210098 0.5674556 -5.3609494 1.267789e-07\n# time_to_treatment::3+:treat  -2.61751913 0.4214689 -6.2104686 1.113671e-09\n</code></pre> <pre><code>* Determine the estimation window\n* The DLM uses observations in [min_time + to, max_time - (abs(from) - 1)]\n* With from=-3, to=3, times 1-20: estimation window is [4, 18]\nsummarize time, meanonly\nlocal tlo = r(min) + 3\nlocal thi = r(max) - 2\n\n* Create binned event-time dummies\ngen byte es_m3 = (years_to_treatment &lt;= -3) &amp; (years_to_treatment != -1000)\ngen byte es_m2 = (years_to_treatment == -2)\n* ref = -1 is omitted\ngen byte es_0  = (years_to_treatment == 0)\ngen byte es_1  = (years_to_treatment == 1)\ngen byte es_2  = (years_to_treatment == 2)\ngen byte es_3  = (years_to_treatment &gt;= 3) &amp; (years_to_treatment != -1000)\n\n* Run the event study\nreghdfe outcome es_m3 es_m2 es_0 es_1 es_2 es_3 ///\n    if (time &gt;= `tlo') &amp; (time &lt;= `thi'), ///\n    absorb(unit time) vce(cluster unit)\n\n* Save ES coefficients (dlm will overwrite e(b) in Step 3)\nmatrix es_b = e(b)\n</code></pre> <p>Output (abridged):</p> <pre><code>HDFE Linear regression                            Number of obs   =      7,500\nAbsorbing 2 HDFE groups                           F(   6,    499) =      25.67\n\n             |               Robust\n     outcome | Coefficient  std. err.      t    P&gt;|t|\n-------------+------------------------------------------------\n       es_m3 |  -.0639588   .4835455    -0.13   0.895\n       es_m2 |   .0946687   .4804238     0.20   0.844\n        es_0 |  -2.763973   .4619066    -5.98   0.000\n        es_1 |  -3.094282   .5204141    -5.95   0.000\n        es_2 |  -2.707691   .5549396    -4.88   0.000\n        es_3 |  -3.256921   .4261997    -7.64   0.000\n</code></pre> <p>Note</p> <p>Stata and R use different random number generators, so <code>seed(42)</code> produces different data in each language. The coefficients differ numerically but the equivalence (DLM = event study) holds in both.</p> <p>Interpretation. The pre-treatment coefficients at \\(t = -3\\) and \\(t = -2\\) are near zero, consistent with parallel trends. The post-treatment coefficients cluster around \u22122.3 to \u22123.3, matching the true effect of \u22123.</p>"},{"location":"getting-started/worked-example/#step-3-run-the-dlm","title":"Step 3: Run the DLM","text":"<p>Now we estimate the same relationship using the DLM. Instead of event-time dummies, the DLM regresses the outcome on leads and lags of the treatment variable itself, then transforms the resulting \"gamma\" coefficients into \"beta\" coefficients via cumulative summation. The betas have the same interpretation as event-study coefficients.</p> RStata <pre><code># Estimate DLM with event window [-3, 3]\nmod &lt;- distributed_lags_model(\n  data = outcome_data,\n  exposure_data = exposure_data,\n  from_rt = -3, to_rt = 3,\n  outcome = \"outcome\", exposure = \"post\",\n  unit = \"group\", time = \"time\"\n)\n\n# DLM beta coefficients\nmod$betas\n#            time_to_event        coef        se\n# post_lead2            -3 -0.11846256 0.4729260\n# post_lead1            -2 -0.06327287 0.5139965\n# post_lag0              0 -2.64104056 0.5438700\n# post_lag1              1 -2.26029265 0.5234023\n# post_lag2              2 -3.04210098 0.5674556\n# post_lag3              3 -2.61751913 0.4214689\n</code></pre> <pre><code>* Estimate DLM with event window [-3, 3]\ndlm outcome, exposure(post) unit(unit) time(time) from(-3) to(3)\n</code></pre> <p>Output:</p> <pre><code>------------------------------------------------------------------------\nDistributed Lag Model (Schmidheiny &amp; Siegloch 2023)\n------------------------------------------------------------------------\n  Outcome:    outcome\n  Exposure:   post\n  Window:     [-3, 3], ref = -1\n  N obs:      7500\n  N clusters: 500\n------------------------------------------------------------------------\n\n        Time        Coef          SE     95% CI lo     95% CI hi\n------------------------------------------------------------------------\n          -3   -0.063959    0.483545     -1.011708      0.883790\n          -2    0.094669    0.480424     -0.846962      1.036299\n          -1       (ref)           .             .             .\n           0   -2.763973    0.461907     -3.669310     -1.858636\n           1   -3.094282    0.520414     -4.114294     -2.074271\n           2   -2.707691    0.554940     -3.795373     -1.620010\n           3   -3.256921    0.426200     -4.092272     -2.421569\n------------------------------------------------------------------------\n</code></pre> <p>The DLM betas are identical to the event-study coefficients from Step 2.</p>"},{"location":"getting-started/worked-example/#step-4-verify-equivalence","title":"Step 4: Verify Equivalence","text":"<p>Let's confirm the equivalence numerically.</p> RStata <pre><code># Compare DLM betas to event-study betas\ncomparison &lt;- data.frame(\n  time = mod$betas$time_to_event,\n  dlm_beta = mod$betas$coef,\n  es_beta = es$betas$coef,\n  difference = abs(mod$betas$coef - es$betas$coef)\n)\nprint(comparison)\n#   time    dlm_beta     es_beta   difference\n# 1   -3 -0.11846256 -0.11846256 2.178119e-13\n# 2   -2 -0.06327287 -0.06327287 3.711059e-13\n# 3    0 -2.64104056 -2.64104056 3.312906e-13\n# 4    1 -2.26029265 -2.26029265 5.448975e-13\n# 5    2 -3.04210098 -3.04210098 3.108624e-14\n# 6    3 -2.61751913 -2.61751913 4.898304e-13\n\ncat(\"Max difference:\", max(comparison$difference), \"\\n\")\n# Max difference: 5.448975e-13\n</code></pre> <pre><code>* Save DLM results\nmatrix dlm_b = e(betas)\n\n* Compare (es_b was saved in Step 2 before dlm overwrote e(b))\ndisplay \"\"\ndisplay \"DLM vs Event Study Comparison:\"\ndisplay \"  Period  DLM beta     ES beta      Difference\"\ndisplay \"  ------  ----------   ----------   ----------\"\n\nlocal periods  \"-3 -2 0 1 2 3\"\nlocal es_cols  \"1 2 3 4 5 6\"\nlocal dlm_rows \"1 2 4 5 6 7\"\n\nforvalues j = 1/6 {\n    local p : word `j' of `periods'\n    local c : word `j' of `es_cols'\n    local r : word `j' of `dlm_rows'\n    local dlm_coef = dlm_b[`r', 2]\n    local es_coef = es_b[1, `c']\n    local diff = abs(`dlm_coef' - `es_coef')\n    display \"  \" %5.0f `p' \"  \" %10.6f `dlm_coef' \"   \" %10.6f `es_coef' \"   \" %10.2e `diff'\n}\n</code></pre> <p>Output:</p> <pre><code>DLM vs Event Study Comparison:\n  Period  DLM beta     ES beta      Difference\n  ------  ----------   ----------   ----------\n     -3   -0.063959    -0.063959     1.24e-13\n     -2    0.094669     0.094669     2.06e-13\n      0   -2.763973    -2.763973     3.40e-13\n      1   -3.094282    -3.094282     2.23e-13\n      2   -2.707691    -2.707691     1.82e-13\n      3   -3.256921    -3.256921     1.24e-13\n</code></pre> <p>The estimates match to machine precision (~\\(10^{-13}\\)). This confirms the theoretical result from Schmidheiny &amp; Siegloch (2023): for a binary absorbing treatment, the DLM is a numerically identical reparametrization of the canonical binned-endpoint event study.</p>"},{"location":"getting-started/worked-example/#step-5-plot-the-results","title":"Step 5: Plot the Results","text":"<p>Both approaches produce the same event-study plot \u2014 coefficients by event time, with the reference period normalized to zero.</p> <p>First, we prepare the data for plotting by adding the reference period (\\(t = -1\\), normalized to zero) back into each set of results:</p> RStata <pre><code># Add the reference period (t = -1, coef = 0) back in for plotting\ndlm_df &lt;- data.frame(\n  time_to_event = c(mod$betas$time_to_event, -1),\n  coef = c(mod$betas$coef, 0),\n  se = c(mod$betas$se, 0)\n)\n\nes_df &lt;- data.frame(\n  time_to_event = c(-3, -2, -1, 0, 1, 2, 3),\n  coef = c(es$betas$coef[1:2], 0, es$betas$coef[3:6]),\n  se = c(es$betas$se[1:2], 0, es$betas$se[3:6])\n)\n</code></pre> <pre><code>* Extract DLM results into a plotting dataset\nmatrix b = e(betas)\n\npreserve\nclear\nlocal nr = rowsof(b)\nset obs `nr'\ngen time_to_event = .\ngen coef = .\ngen ci_lo = .\ngen ci_hi = .\nforvalues i = 1/`nr' {\n    replace time_to_event = b[`i', 1] in `i'\n    replace coef = b[`i', 2] in `i'\n    replace ci_lo = b[`i', 4] in `i'\n    replace ci_hi = b[`i', 5] in `i'\n}\n</code></pre> <p>Now plot the canonical event-study estimates:</p> RStata <pre><code>ggplot(es_df, aes(x = time_to_event, y = coef)) +\n  geom_hline(yintercept = 0, lty = 2, color = \"red\") +\n  geom_vline(xintercept = -0.5, lty = 2, color = \"gray50\") +\n  geom_ribbon(aes(ymin = coef - 1.96 * se, ymax = coef + 1.96 * se),\n              alpha = 0.2, fill = \"grey20\") +\n  geom_line(color = \"black\", linewidth = 0.8) +\n  geom_point(color = \"black\", size = 2.5) +\n  scale_x_continuous(breaks = -3:3) +\n  labs(title = \"Canonical Event Study\",\n       x = \"Periods to Treatment\", y = \"Coefficient\") +\n  theme_minimal(base_size = 10) +\n  theme(aspect.ratio = 0.6,\n        plot.title = element_text(size = 11, face = \"bold\", hjust = 0),\n        panel.grid.minor = element_blank())\n</code></pre> <pre><code>* (Using the ES coefficients stored in _b[] from Step 2)\n* Plot follows the same pattern as the DLM plot below\n</code></pre> <p></p> <p>And the DLM estimates:</p> RStata <pre><code>ggplot(dlm_df, aes(x = time_to_event, y = coef)) +\n  geom_hline(yintercept = 0, lty = 2, color = \"red\") +\n  geom_vline(xintercept = -0.5, lty = 2, color = \"gray50\") +\n  geom_ribbon(aes(ymin = coef - 1.96 * se, ymax = coef + 1.96 * se),\n              alpha = 0.2, fill = \"grey20\") +\n  geom_line(color = \"black\", linewidth = 0.8) +\n  geom_point(color = \"black\", size = 2.5) +\n  scale_x_continuous(breaks = -3:3) +\n  labs(title = \"Distributed Lag Model\",\n       x = \"Periods to Treatment\", y = \"Coefficient\") +\n  theme_minimal(base_size = 10) +\n  theme(aspect.ratio = 0.6,\n        plot.title = element_text(size = 11, face = \"bold\", hjust = 0),\n        panel.grid.minor = element_blank())\n</code></pre> <pre><code>dlm_plot, title(\"Event-Study Plot\") xtitle(\"Periods to Treatment\") ytitle(\"Coefficient\")\nrestore\ndrop es_*\n</code></pre> <p></p> <p>The two plots are identical. We can overlay them to confirm:</p> R <pre><code>combined_df &lt;- rbind(\n  dlm_df %&gt;% mutate(method = \"DLM\"),\n  es_df %&gt;% mutate(method = \"Event Study\")\n)\n\nggplot(combined_df, aes(x = time_to_event, y = coef, color = method)) +\n  geom_hline(yintercept = 0, linetype = \"dashed\", color = \"gray50\") +\n  geom_vline(xintercept = -0.5, linetype = \"dashed\", color = \"gray80\") +\n  geom_pointrange(aes(ymin = coef - 1.96 * se, ymax = coef + 1.96 * se),\n                  position = position_dodge(width = 0.3),\n                  size = 0.7, linewidth = 0.9) +\n  scale_color_manual(values = c(\"DLM\" = \"#e74c3c\", \"Event Study\" = \"#2980b9\")) +\n  scale_x_continuous(breaks = -3:3) +\n  labs(title = \"DLM vs. Canonical Event Study\",\n       subtitle = \"Estimates are numerically identical for binary absorbing treatments\",\n       x = \"Periods to Treatment\", y = \"Coefficient\", color = \"\") +\n  theme_minimal(base_size = 14) +\n  theme(legend.position = \"bottom\")\n</code></pre> <p></p> <p>Flat pre-trends near zero, then a sharp drop to around \u22122.6 at treatment onset \u2014 consistent with the true effect of \u22123. The DLM (red) and event study (blue) estimates are numerically identical.</p>"},{"location":"getting-started/worked-example/#why-this-matters","title":"Why This Matters","text":"<p>This example uses a binary absorbing treatment \u2014 the special case where the canonical event study works. Both approaches give the same answer, so why bother with DLMs?</p> <p>The DLM's advantage appears when the treatment is continuous \u2014 e.g., a tax rate that changes from 0% to 5% to 8.5%, a minimum wage that increases in steps, or a policy dosage that varies across units and over time. In those settings, you can't create event-time dummies (there is no single \"event\"), but the DLM's lead/lag framework handles it naturally. See the Theory page for a concrete illustration with continuous treatment data.</p>"},{"location":"r/api/","title":"R API Reference","text":""},{"location":"r/api/#distributed_lags_model","title":"<code>distributed_lags_model()</code>","text":"<p>Estimate a single-outcome distributed lag model.</p>"},{"location":"r/api/#usage","title":"Usage","text":"<pre><code>distributed_lags_model(\n  data,\n  exposure_data,\n  from_rt,\n  to_rt,\n  outcome,\n  exposure,\n  unit,\n  time,\n  covariates = NULL,\n  addl_fes = NULL,\n  ref_period = -1,\n  weights = NULL,\n  dd = FALSE,\n  n = 2,\n  dict = NULL,\n  time_labels = NULL\n)\n</code></pre>"},{"location":"r/api/#arguments","title":"Arguments","text":"Argument Description <code>data</code> Data frame with unit, time, outcome, and covariates <code>exposure_data</code> Data frame with unit, time, and exposure variable <code>from_rt</code> Starting relative period (negative integer) <code>to_rt</code> Ending relative period (positive integer) <code>outcome</code> String: name of the outcome variable <code>exposure</code> String: name of the exposure variable <code>unit</code> String: name of the unit identifier <code>time</code> String: name of the time variable <code>covariates</code> Character vector of covariate names (default: <code>NULL</code>) <code>addl_fes</code> Character vector of additional FE variables (default: <code>NULL</code>) <code>ref_period</code> Reference period (default: \u22121) <code>weights</code> String: name of weight variable (default: <code>NULL</code>) <code>dd</code> Logical: include DD companion estimate in plot (default: <code>FALSE</code>) <code>n</code> Integer: number of digits for DD companion (default: 2) <code>dict</code> Named vector for renaming axes in the plot (default: <code>NULL</code>) <code>time_labels</code> Named vector mapping time period values to display labels for the plot caption (default: <code>NULL</code>). E.g., <code>c(\"4\" = \"Jan 2010\", \"18\" = \"Dec 2016\")</code>. The earliest and latest included periods are looked up in this mapping; unmatched values fall back to raw numbers."},{"location":"r/api/#return-value","title":"Return Value","text":"<p>A list with:</p> Element Type Description <code>betas</code> data.frame Columns: <code>time_to_event</code>, <code>coef</code>, <code>se</code> <code>plot</code> ggplot Event-study plot with confidence intervals <code>model</code> fixest The estimated <code>feols</code> model object <code>vcov</code> matrix Variance-covariance matrix of gamma coefficients <code>data_periods_included</code> vector Calendar periods included in estimation <code>fmla_str</code> string Formula string used in <code>feols</code> <code>from_rt</code> numeric From period (echo) <code>to_rt</code> numeric To period (echo) <code>exposure</code> string Exposure variable name (echo) <code>outcome</code> string Outcome variable name (echo)"},{"location":"r/api/#distributed_lags_models","title":"<code>distributed_lags_models()</code>","text":"<p>Estimate DLMs for multiple outcomes in a single call.</p>"},{"location":"r/api/#usage_1","title":"Usage","text":"<pre><code>distributed_lags_models(\n  data, exposure_data, from_rt, to_rt,\n  outcomes, exposure, unit, time, ...\n)\n</code></pre> <p>Takes the same arguments as <code>distributed_lags_model()</code>, except <code>outcomes</code> (plural) is a character vector. Returns a list of model results, one per outcome.</p>"},{"location":"r/api/#generate_data","title":"<code>generate_data()</code>","text":"<p>Generate a balanced panel with staggered treatment for testing.</p>"},{"location":"r/api/#usage_2","title":"Usage","text":"<pre><code>generate_data(seed = 1234, n_groups = 676, n_times = 20, treat_prob = 0.4)\n</code></pre>"},{"location":"r/api/#return-value_1","title":"Return Value","text":"<p>A data frame with columns: <code>group</code>, <code>time</code>, <code>treat</code>, <code>treatment_time</code>, <code>years_to_treatment</code>, <code>post</code>, <code>outcome</code>.</p>"},{"location":"r/api/#standard_twfe_for_comparison","title":"<code>standard_twfe_for_comparison()</code>","text":"<p>Estimate a standard binned-endpoint TWFE event study for comparison with DLM results.</p>"},{"location":"r/api/#usage_3","title":"Usage","text":"<pre><code>standard_twfe_for_comparison(\n  data, from_rt, to_rt, outcome, time, unit,\n  time_to_treatment, treat, covariates = NULL,\n  ref_period = -1, weights = NULL\n)\n</code></pre>"},{"location":"r/api/#helper-functions","title":"Helper Functions","text":"Function Description <code>revcumsum(x)</code> Reverse cumulative sum of a vector <code>secumsum(cov)</code> SE of forward cumulative sum from a VCV matrix <code>serevcumsum(cov)</code> SE of reverse cumulative sum from a VCV matrix"},{"location":"r/guide/","title":"R Guide","text":""},{"location":"r/guide/#basic-usage","title":"Basic Usage","text":"<pre><code>library(dlm)\n\nmod &lt;- distributed_lags_model(\n  data = outcome_data,\n  exposure_data = treatment_data,\n  from_rt = -3, to_rt = 3,\n  outcome = \"y\", exposure = \"treated\",\n  unit = \"id\", time = \"year\"\n)\n</code></pre> <p>The R version takes separate data frames for outcomes and exposure. This is useful when the exposure is defined at a different level (e.g., pharmacy-level treatment merged onto beneficiary-level outcomes).</p>"},{"location":"r/guide/#data-setup","title":"Data Setup","text":"<p>The R DLM expects two data frames:</p> <ol> <li><code>data</code> \u2014 contains unit, time, outcome, and any covariates</li> <li><code>exposure_data</code> \u2014 contains unit, time, and the exposure variable (one row per unit-time)</li> </ol> <pre><code>library(dlm)\nlibrary(dplyr)\n\n# Example: separate outcome and exposure data\noutcome_data &lt;- full_data %&gt;% select(id, year, y, x1, x2)\nexposure_data &lt;- full_data %&gt;% select(id, year, treated) %&gt;% distinct()\n</code></pre> <p>If your data is a single data frame, just select the relevant columns:</p> <pre><code>df &lt;- generate_data(seed = 42)\n\ndata &lt;- df %&gt;% select(group, time, outcome)\nexposure_data &lt;- df %&gt;% select(group, time, post) %&gt;% distinct()\n</code></pre>"},{"location":"r/guide/#examples","title":"Examples","text":""},{"location":"r/guide/#basic-estimation","title":"Basic estimation","text":"<pre><code>library(dlm)\nlibrary(dplyr)\n\ndf &lt;- generate_data(seed = 42, n_groups = 500, n_times = 20, treat_prob = 0.4)\n\ndata &lt;- df %&gt;% select(group, time, outcome)\nexposure_data &lt;- df %&gt;% select(group, time, post) %&gt;% distinct()\n\nmod &lt;- distributed_lags_model(\n  data = data,\n  exposure_data = exposure_data,\n  from_rt = -3, to_rt = 3,\n  outcome = \"outcome\", exposure = \"post\",\n  unit = \"group\", time = \"time\"\n)\n\nmod$betas\n</code></pre> <p>Output:</p> <pre><code>           time_to_event        coef        se\npost_lead2            -3 -0.11846256 0.4729260\npost_lead1            -2 -0.06327287 0.5139965\npost_lag0              0 -2.64104056 0.5438700\npost_lag1              1 -2.26029265 0.5234023\npost_lag2              2 -3.04210098 0.5674556\npost_lag3              3 -2.61751913 0.4214689\n</code></pre>"},{"location":"r/guide/#custom-reference-period","title":"Custom reference period","text":"<pre><code>mod &lt;- distributed_lags_model(\n  data = data,\n  exposure_data = exposure_data,\n  from_rt = -3, to_rt = 3,\n  outcome = \"outcome\", exposure = \"post\",\n  unit = \"group\", time = \"time\",\n  ref_period = -2\n)\n</code></pre>"},{"location":"r/guide/#with-covariates","title":"With covariates","text":"<pre><code>data_with_covs &lt;- df %&gt;% select(group, time, outcome, x1, x2)\n\nmod &lt;- distributed_lags_model(\n  data = data_with_covs,\n  exposure_data = exposure_data,\n  from_rt = -3, to_rt = 3,\n  outcome = \"outcome\", exposure = \"post\",\n  unit = \"group\", time = \"time\",\n  covariates = c(\"x1\", \"x2\")\n)\n</code></pre>"},{"location":"r/guide/#additional-fixed-effects","title":"Additional fixed effects","text":"<pre><code>mod &lt;- distributed_lags_model(\n  data = data,\n  exposure_data = exposure_data,\n  from_rt = -3, to_rt = 3,\n  outcome = \"outcome\", exposure = \"post\",\n  unit = \"group\", time = \"time\",\n  addl_fes = c(\"region\")\n)\n</code></pre>"},{"location":"r/guide/#multiple-outcomes","title":"Multiple outcomes","text":"<p>Use <code>distributed_lags_models</code> (plural) to estimate multiple outcomes:</p> <pre><code>mods &lt;- distributed_lags_models(\n  data = data,\n  exposure_data = exposure_data,\n  from_rt = -3, to_rt = 3,\n  outcomes = c(\"outcome1\", \"outcome2\"),\n  exposure = \"post\",\n  unit = \"group\", time = \"time\"\n)\n\n# Access each model\nmods[[1]]$betas\nmods[[2]]$betas\n</code></pre>"},{"location":"r/guide/#weighted-regression","title":"Weighted regression","text":"<pre><code>mod &lt;- distributed_lags_model(\n  data = data,\n  exposure_data = exposure_data,\n  from_rt = -3, to_rt = 3,\n  outcome = \"outcome\", exposure = \"post\",\n  unit = \"group\", time = \"time\",\n  weights = \"pop_weight\"\n)\n</code></pre>"},{"location":"r/guide/#working-with-results","title":"Working with Results","text":"<p>The returned object is a list:</p> <pre><code>names(mod)\n# [1] \"betas\" \"plot\" \"model\" \"vcov\" \"data_periods_included\"\n# [6] \"fmla_str\" \"from_rt\" \"to_rt\" \"exposure\" \"outcome\"\n</code></pre>"},{"location":"r/guide/#beta-coefficients","title":"Beta coefficients","text":"<pre><code>mod$betas\n#            time_to_event        coef        se\n# post_lead2            -3 -0.11846256 0.4729260\n# post_lead1            -2 -0.06327287 0.5139965\n# post_lag0              0 -2.64104056 0.5438700\n# post_lag1              1 -2.26029265 0.5234023\n# post_lag2              2 -3.04210098 0.5674556\n# post_lag3              3 -2.61751913 0.4214689\n</code></pre>"},{"location":"r/guide/#built-in-event-study-plot","title":"Built-in event-study plot","text":"<pre><code>mod$plot\n</code></pre> <p>The plot is a <code>ggplot2</code> object. Customize it further:</p> <pre><code>mod$plot +\n  ggplot2::labs(title = \"My Event Study\", x = \"Years to Treatment\")\n</code></pre> <p></p> <p>You can also use <code>time_labels</code> to map time period values to readable labels in the caption:</p> <pre><code>mod &lt;- distributed_lags_model(\n  data = data,\n  exposure_data = exposure_data,\n  from_rt = -3, to_rt = 3,\n  outcome = \"outcome\", exposure = \"post\",\n  unit = \"group\", time = \"time\",\n  time_labels = c(\"4\" = \"Jan 2010\", \"18\" = \"Dec 2016\")\n)\n# Caption will show \"From Jan 2010 To Dec 2016\" instead of \"From 4 To 18\"\n</code></pre>"},{"location":"r/guide/#access-the-underlying-fixest-model","title":"Access the underlying fixest model","text":"<pre><code>summary(mod$model)\nfixest::coeftable(mod$model)\n</code></pre>"},{"location":"r/guide/#test-data-generator","title":"Test Data Generator","text":"<pre><code>df &lt;- generate_data(seed = 42, n_groups = 500, n_times = 20, treat_prob = 0.4)\n</code></pre> Argument Default Description <code>seed</code> 1234 Random seed <code>n_groups</code> 676 Number of panel units <code>n_times</code> 20 Number of time periods <code>treat_prob</code> 0.4 Treatment probability <p>Key variables: <code>group</code>, <code>time</code>, <code>treat</code>, <code>treatment_time</code>, <code>years_to_treatment</code>, <code>post</code>, <code>outcome</code>.</p>"},{"location":"stata/api/","title":"Stata API Reference","text":""},{"location":"stata/api/#dlm","title":"<code>dlm</code>","text":"<p>Estimate a distributed lag model.</p>"},{"location":"stata/api/#syntax","title":"Syntax","text":"<pre><code>dlm depvar [if] [in], exposure(varname) unit(varname) time(varname)\n    from(#) to(#) [ref(#) covariates(varlist) addl_fes(varlist) verbose]\n</code></pre>"},{"location":"stata/api/#required-options","title":"Required Options","text":"Option Description <code>exposure(varname)</code> Treatment/exposure variable (numeric, typically 0/1) <code>unit(varname)</code> Panel unit identifier <code>time(varname)</code> Time period variable (numeric, evenly spaced) <code>from(#)</code> Earliest relative period to estimate (negative integer, e.g. \u22123) <code>to(#)</code> Latest relative period to estimate (positive integer, e.g. 3)"},{"location":"stata/api/#optional","title":"Optional","text":"Option Default Description <code>ref(#)</code> \u22121 Reference (omitted) period <code>covariates(varlist)</code> \u2014 Control variables included in the regression <code>addl_fes(varlist)</code> \u2014 Additional fixed effects passed to <code>reghdfe absorb()</code> <code>verbose</code> off Display progress information"},{"location":"stata/api/#stored-results","title":"Stored Results","text":""},{"location":"stata/api/#scalars","title":"Scalars","text":"Name Description <code>e(N)</code> Number of observations <code>e(N_clust)</code> Number of clusters <code>e(from)</code> Starting relative period <code>e(to)</code> Ending relative period <code>e(ref_period)</code> Reference period"},{"location":"stata/api/#macros","title":"Macros","text":"Name Description <code>e(cmd)</code> <code>\"dlm\"</code> <code>e(outcome)</code> Outcome variable name <code>e(exposure)</code> Exposure variable name <code>e(unit)</code> Unit variable name <code>e(time)</code> Time variable name"},{"location":"stata/api/#matrices","title":"Matrices","text":"Name Dimensions Description <code>e(betas)</code> (to \u2212 from + 1) \u00d7 5 Columns: time_to_event, coef, se, ci_lo, ci_hi. Includes reference period row (coef = 0, se = 0). <code>e(gamma)</code> 1 \u00d7 ( from <code>e(gamma_V)</code> ( from"},{"location":"stata/api/#dlm_plot","title":"<code>dlm_plot</code>","text":"<p>Plot event study results from a prior <code>dlm</code> estimation. Must be run immediately after <code>dlm</code>.</p>"},{"location":"stata/api/#syntax_1","title":"Syntax","text":"<pre><code>dlm_plot [, title(string) xtitle(string) ytitle(string)\n    from_label(string) to_label(string) saving(string)]\n</code></pre>"},{"location":"stata/api/#options","title":"Options","text":"Option Default Description <code>title(string)</code> \"Event Study (DLM)\" Plot title <code>xtitle(string)</code> \"Time to Unit Change in {Exposure}\" X-axis label <code>ytitle(string)</code> \"Coefficient\" Y-axis label <code>from_label(string)</code> \u2014 Label for \"From\" in caption (e.g., \"Jan 2010\"). If both <code>from_label</code> and <code>to_label</code> are specified, caption shows \"From ... To ...\". <code>to_label(string)</code> \u2014 Label for \"To\" in caption (e.g., \"Dec 2016\") <code>saving(string)</code> \u2014 Export plot to file (e.g., <code>saving(\"plot.png\")</code>)"},{"location":"stata/api/#dlm_gen_data","title":"<code>dlm_gen_data</code>","text":"<p>Generate balanced panel test data with staggered treatment.</p>"},{"location":"stata/api/#syntax_2","title":"Syntax","text":"<pre><code>dlm_gen_data [, n_groups(#) n_times(#) treat_prob(#) seed(#) clear]\n</code></pre>"},{"location":"stata/api/#options_1","title":"Options","text":"Option Default Description <code>n_groups(#)</code> 676 Number of panel units <code>n_times(#)</code> 20 Number of time periods <code>treat_prob(#)</code> 0.4 Fraction of units randomly assigned to treatment (0 &lt; p &lt; 1) <code>seed(#)</code> 12345 Random number seed <code>clear</code> \u2014 Clear data in memory before generating"},{"location":"stata/api/#variables-created","title":"Variables Created","text":"Variable Type Description <code>unit</code> long Unit identifier (1 to <code>n_groups</code>) <code>time</code> long Time period (1 to <code>n_times</code>) <code>treat</code> byte 1 if unit ever treated, 0 otherwise <code>treatment_time</code> long Period when treatment begins (7, 8, or 9; missing if never treated) <code>years_to_treatment</code> long Event time (\u22121000 for never-treated units) <code>post</code> byte 1 if post-treatment, 0 otherwise <code>outcome</code> double N(0, 5) noise + (\u22123) \u00d7 post"},{"location":"stata/api/#data-generating-process","title":"Data Generating Process","text":"<p>Treatment timing is drawn uniformly from {7, 8, 9}. The outcome equals:</p> \\[y_{it} = \\varepsilon_{it} - 3 \\cdot \\mathbf{1}[t \\geq t^*_i]\\] <p>where \\(\\varepsilon_{it} \\sim N(0, 25)\\) and \\(t^*_i\\) is unit \\(i\\)'s treatment time.</p>"},{"location":"stata/guide/","title":"Stata Guide","text":""},{"location":"stata/guide/#basic-usage","title":"Basic Usage","text":"<pre><code>dlm depvar, exposure(varname) unit(varname) time(varname) from(#) to(#)\n</code></pre> <p>The <code>dlm</code> command estimates a distributed lag model on <code>depvar</code>, using <code>exposure</code> as the treatment indicator. Unit and time fixed effects are absorbed via <code>reghdfe</code>, and standard errors are clustered at the unit level.</p>"},{"location":"stata/guide/#options","title":"Options","text":"Option Required Description <code>exposure(varname)</code> Yes Treatment/exposure variable (typically 0/1) <code>unit(varname)</code> Yes Panel unit identifier <code>time(varname)</code> Yes Time period variable (numeric, evenly spaced) <code>from(#)</code> Yes Earliest relative period (negative integer) <code>to(#)</code> Yes Latest relative period (positive integer) <code>ref(#)</code> No Reference period (default: \u22121) <code>covariates(varlist)</code> No Additional control variables <code>addl_fes(varlist)</code> No Additional fixed effects beyond unit and time <code>verbose</code> No Display progress information"},{"location":"stata/guide/#examples","title":"Examples","text":""},{"location":"stata/guide/#basic-estimation","title":"Basic estimation","text":"<pre><code>dlm_gen_data, n_groups(500) n_times(20) treat_prob(0.4) seed(42) clear\n\ndlm outcome, exposure(post) unit(unit) time(time) from(-3) to(3)\n</code></pre> <p>Output:</p> <pre><code>------------------------------------------------------------------------\nDistributed Lag Model (Schmidheiny &amp; Siegloch 2023)\n------------------------------------------------------------------------\n  Outcome:    outcome\n  Exposure:   post\n  Window:     [-3, 3], ref = -1\n  N obs:      7500\n  N clusters: 500\n------------------------------------------------------------------------\n\n        Time        Coef          SE     95% CI lo     95% CI hi\n------------------------------------------------------------------------\n          -3   -0.063959    0.483545     -1.011708      0.883790\n          -2    0.094669    0.480424     -0.846962      1.036299\n          -1       (ref)           .             .             .\n           0   -2.763973    0.461907     -3.669310     -1.858636\n           1   -3.094282    0.520414     -4.114294     -2.074271\n           2   -2.707691    0.554940     -3.795373     -1.620010\n           3   -3.256921    0.426200     -4.092272     -2.421569\n------------------------------------------------------------------------\n</code></pre>"},{"location":"stata/guide/#wider-event-window","title":"Wider event window","text":"<pre><code>dlm outcome, exposure(post) unit(unit) time(time) from(-5) to(5)\n</code></pre>"},{"location":"stata/guide/#custom-reference-period","title":"Custom reference period","text":"<pre><code>dlm outcome, exposure(post) unit(unit) time(time) from(-3) to(3) ref(-2)\n</code></pre>"},{"location":"stata/guide/#with-covariates","title":"With covariates","text":"<p>If your dataset includes control variables, pass them with <code>covariates()</code>:</p> <pre><code>* Generate data and add a covariate\ndlm_gen_data, n_groups(500) n_times(20) treat_prob(0.4) seed(42) clear\ngen double x1 = rnormal()\n\ndlm outcome, exposure(post) unit(unit) time(time) from(-3) to(3) covariates(x1)\n</code></pre>"},{"location":"stata/guide/#additional-fixed-effects","title":"Additional fixed effects","text":"<p>To absorb fixed effects beyond the default unit and time FEs (e.g., region-by-year):</p> <pre><code>dlm outcome, exposure(post) unit(unit) time(time) from(-3) to(3) addl_fes(region)\n</code></pre>"},{"location":"stata/guide/#subsetting-with-ifin","title":"Subsetting with if/in","text":"<pre><code>dlm outcome if unit &lt;= 250, exposure(post) unit(unit) time(time) from(-3) to(3)\n</code></pre>"},{"location":"stata/guide/#multiple-outcomes","title":"Multiple outcomes","text":"<p>Stata convention is one outcome per call. Loop for multiple:</p> <pre><code>foreach var of varlist outcome1 outcome2 outcome3 {\n    dlm `var', exposure(post) unit(unit) time(time) from(-3) to(3)\n    matrix betas_`var' = e(betas)\n}\n</code></pre>"},{"location":"stata/guide/#working-with-results","title":"Working with Results","text":""},{"location":"stata/guide/#extract-the-betas-matrix","title":"Extract the betas matrix","text":"<pre><code>dlm outcome, exposure(post) unit(unit) time(time) from(-3) to(3)\nmatrix b = e(betas)\n\n* Access individual cells: b[row, col]\n* Columns: 1=time_to_event, 2=coef, 3=se, 4=ci_lo, 5=ci_hi\ndisplay \"Effect at t=0: \" b[4, 2]  // 4th row = period 0 (for from=-3)\n</code></pre>"},{"location":"stata/guide/#export-to-csv","title":"Export to CSV","text":"<pre><code>dlm outcome, exposure(post) unit(unit) time(time) from(-3) to(3)\nmatrix b = e(betas)\n\n* Convert to dataset and export\npreserve\nclear\nlocal nrows = rowsof(b)\nset obs `nrows'\ngen time_to_event = .\ngen coef = .\ngen se = .\ngen ci_lo = .\ngen ci_hi = .\nforvalues i = 1/`nrows' {\n    replace time_to_event = b[`i', 1] in `i'\n    replace coef = b[`i', 2] in `i'\n    replace se = b[`i', 3] in `i'\n    replace ci_lo = b[`i', 4] in `i'\n    replace ci_hi = b[`i', 5] in `i'\n}\nexport delimited using \"dlm_results.csv\", replace\nrestore\n</code></pre>"},{"location":"stata/guide/#plot-results","title":"Plot results","text":"<p>After estimation, use <code>dlm_plot</code> for a publication-quality event study plot:</p> <pre><code>dlm outcome, exposure(post) unit(unit) time(time) from(-3) to(3)\ndlm_plot, title(\"Event Study (DLM)\") xtitle(\"Time to Treatment\") ytitle(\"Coefficient\")\n</code></pre> <p>Options for <code>dlm_plot</code>:</p> Option Description <code>title(string)</code> Plot title (default: \"Event Study (DLM)\") <code>xtitle(string)</code> X-axis title (default: \"Time to Unit Change in {Exposure}\") <code>ytitle(string)</code> Y-axis title (default: \"Coefficient\") <code>from_label(string)</code> Label for \"From\" in caption (e.g., \"Jan 2010\") <code>to_label(string)</code> Label for \"To\" in caption (e.g., \"Dec 2016\") <code>saving(string)</code> Export plot to file (e.g., \"plot.png\") <p></p>"},{"location":"stata/guide/#data-preservation","title":"Data Preservation","text":"<p><code>dlm</code> uses <code>preserve</code>/<code>restore</code> internally. Your original dataset is never modified \u2014 no temporary variables leak into your data, and the observation count remains unchanged.</p>"},{"location":"stata/guide/#test-data-generator","title":"Test Data Generator","text":"<p><code>dlm_gen_data</code> creates balanced panel data for testing:</p> <pre><code>dlm_gen_data, n_groups(500) n_times(20) treat_prob(0.4) seed(42) clear\n</code></pre> Option Default Description <code>n_groups(#)</code> 676 Number of panel units <code>n_times(#)</code> 20 Number of time periods <code>treat_prob(#)</code> 0.4 Fraction of units assigned to treatment <code>seed(#)</code> 12345 Random seed for reproducibility <code>clear</code> \u2014 Clear existing data in memory"},{"location":"theory/background/","title":"Mathematical Background","text":"<p>This page summarizes the key theoretical results from Schmidheiny and Siegloch (2023), \"On event studies and distributed-lag models: Equivalence, generalization and practical implications,\" Journal of Applied Econometrics, 38(5): 695\u2013713.</p>"},{"location":"theory/background/#intuition-from-event-studies-to-dlms","title":"Intuition: From Event Studies to DLMs","text":"<p>Most researchers are familiar with the canonical event study. This section uses that familiarity as a starting point and shows, step by step, how the distributed lag model is a reparametrization of the same idea \u2014 and why that reparametrization unlocks continuous treatments.</p>"},{"location":"theory/background/#step-1-the-canonical-event-study-what-you-already-know","title":"Step 1: The canonical event study (what you already know)","text":"<p>In a canonical event study, you observe a panel of units over time. Some units receive a binary treatment that turns on at a known date and stays on. You want to trace out the treatment effect dynamically \u2014 how does the outcome change at 2 periods before treatment, 1 period before, the period of treatment, 1 period after, etc.?</p> <p>To do this, you create event-time dummy variables. Each dummy equals 1 if a unit is exactly \\(k\\) periods away from its treatment onset, and 0 otherwise. You pick a reference period (typically \\(k = -1\\)) and omit it. Then you regress the outcome on these dummies plus unit and time fixed effects.</p> <p>Concrete example. Suppose Unit A is treated at time 5 and you want a window from \\(-2\\) to \\(+2\\) with reference period \\(-1\\). Your data looks like:</p> unit time outcome event_time \\(D_{-2}\\) \\(D_{0}\\) \\(D_{1}\\) \\(D_{2}\\) A 3 12.3 \u22122 1 0 0 0 A 4 11.9 \u22121 (ref) 0 0 0 0 A 5 8.7 0 0 1 0 0 A 6 9.1 1 0 0 1 0 A 7 8.4 2 0 0 0 1 <p>You then estimate:</p> \\[y_{it} = \\alpha_i + \\lambda_t + \\beta_{-2} D_{it}^{-2} + \\beta_0 D_{it}^{0} + \\beta_1 D_{it}^{1} + \\beta_2 D_{it}^{2} + \\varepsilon_{it}\\] <p>The \\(\\beta\\) coefficients are your event-study estimates \u2014 each one measures the treatment effect at a particular time horizon relative to the reference period.</p>"},{"location":"theory/background/#step-2-the-dlm-same-data-different-columns","title":"Step 2: The DLM (same data, different columns)","text":"<p>The DLM takes the same data but constructs different regressors. Instead of asking \"what event-time period is this unit in?\", it asks: \"what is this unit's treatment status at various time offsets?\"</p> <p>Specifically, it creates leads (future values) and lags (current and past values) of the treatment variable. For the same window (\\(-2\\) to \\(+2\\)), it creates:</p> <ul> <li>\\(x_{t+1}\\): treatment value 1 period in the future (1 lead, because \\(|-2| - 1 = 1\\))</li> <li>\\(x_{t}\\): treatment value now (lag 0)</li> <li>\\(x_{t-1}\\): treatment value 1 period in the past (lag 1)</li> <li>\\(x_{t-2}\\): treatment value 2 periods in the past (lag 2)</li> </ul> <p>Here is the same data for Unit A (treated at time 5, so <code>post</code> switches from 0 to 1 at time 5):</p> unit time outcome post \\(x_{t+1}\\) \\(x_{t}\\) \\(x_{t-1}\\) \\(x_{t-2}\\) A 3 12.3 0 0 0 0 0 A 4 11.9 0 1 0 0 0 A 5 8.7 1 1 1 0 0 A 6 9.1 1 1 1 1 0 A 7 8.4 1 1 1 1 1 <p>You then estimate:</p> \\[y_{it} = \\alpha_i + \\lambda_t + \\gamma_1^{\\text{lead}} \\cdot x_{i,t+1} + \\gamma_0^{\\text{lag}} \\cdot x_{it} + \\gamma_1^{\\text{lag}} \\cdot x_{i,t-1} + \\gamma_2^{\\text{lag}} \\cdot x_{i,t-2} + \\varepsilon_{it}\\] <p>The \\(\\gamma\\) coefficients measure incremental changes in the treatment effect at each time offset.</p>"},{"location":"theory/background/#step-3-the-equivalence-betas-cumulative-sums-of-gammas","title":"Step 3: The equivalence (betas = cumulative sums of gammas)","text":"<p>The key result from Schmidheiny &amp; Siegloch (2023) is that the event-study \\(\\beta\\) coefficients are just cumulative sums of the DLM \\(\\gamma\\) coefficients:</p> Event-study \\(\\beta\\) Equals Intuition \\(\\beta_{-2}\\) \\(-\\gamma_1^{\\text{lead}}\\) Negative of the single lead gamma \\(\\beta_{-1}\\) 0 (reference) Normalized to zero \\(\\beta_{0}\\) \\(\\gamma_0^{\\text{lag}}\\) Just the contemporaneous gamma \\(\\beta_{1}\\) \\(\\gamma_0^{\\text{lag}} + \\gamma_1^{\\text{lag}}\\) Cumulative sum of two gammas \\(\\beta_{2}\\) \\(\\gamma_0^{\\text{lag}} + \\gamma_1^{\\text{lag}} + \\gamma_2^{\\text{lag}}\\) Cumulative sum of three gammas <p>In other words, gammas are incremental (the marginal change at each step) and betas are cumulative (the total effect up to that point). The two representations contain exactly the same information \u2014 you can always convert between them.</p> <p>When applied to binary treatment data, the DLM betas are numerically identical to the event-study betas. Both the R and Stata packages verify this to machine precision (~10\u207b\u00b9\u00b3).</p>"},{"location":"theory/background/#step-4-why-this-matters-continuous-treatments","title":"Step 4: Why this matters \u2014 continuous treatments","text":"<p>With a binary treatment, both approaches give identical answers, and event-time dummies are perfectly natural. But now consider a continuous treatment \u2014 say, a tax rate that changes by different amounts at different times:</p> unit time outcome tax_rate A 3 12.3 0 A 4 11.9 0 A 5 8.7 5.0 A 6 7.1 8.5 A 7 9.4 3.0 <p>The canonical event study breaks down. There is no single \"treatment onset\" to anchor event-time dummies. When did treatment start \u2014 when the rate went to 5? And what is \"2 periods after treatment\" when the rate keeps changing? Researchers who want to use event-time dummies here must typically dichotomize the treatment into \"big changes\" vs. no change, discarding variation and fundamentally altering the analysis (Schmidheiny &amp; Siegloch 2023, Section 4.3).</p> <p>The DLM works perfectly. Just create leads and lags of <code>tax_rate</code>:</p> unit time outcome tax_rate \\(x_{t+1}\\) \\(x_t\\) \\(x_{t-1}\\) \\(x_{t-2}\\) A 3 12.3 0 0 0 0 0 A 4 11.9 0 5.0 0 0 0 A 5 8.7 5.0 8.5 5.0 0 0 A 6 7.1 8.5 3.0 8.5 5.0 0 A 7 9.4 3.0 ... 3.0 8.5 5.0 <p>The same regression specification works. The gammas now measure the effect of a one-unit increase in the treatment variable at each time offset, and the betas (cumulative sums) trace out a dynamic treatment effect plot \u2014 exactly the kind of plot researchers are used to seeing from event studies, but now for a continuous treatment.</p> <p>This is the core contribution of the DLM framework: it generalizes the canonical event study to continuous treatments while being exactly equivalent in the binary case.</p>"},{"location":"theory/background/#formal-specification","title":"Formal Specification","text":"<p>The sections below present the formal econometric specification from Schmidheiny &amp; Siegloch (2023).</p>"},{"location":"theory/background/#event-study-regression","title":"Event-Study Regression","text":"<p>The standard event-study specification is:</p> \\[y_{it} = \\alpha_i + \\lambda_t + \\sum_{\\substack{k = \\underline{k} \\\\ k \\neq k^*}}^{\\bar{k}} \\beta_k \\cdot D_{it}^k + \\varepsilon_{it}\\] <p>where:</p> <ul> <li>\\(\\alpha_i\\) and \\(\\lambda_t\\) are unit and time fixed effects</li> <li>\\(D_{it}^k\\) are event-time indicators (1 if unit \\(i\\) is \\(k\\) periods from treatment at time \\(t\\))</li> <li>\\(k^*\\) is the omitted reference period (typically \u22121)</li> <li>\\(\\underline{k}\\) and \\(\\bar{k}\\) are the endpoints of the event window</li> <li>The endpoint dummies are binned: \\(D_{it}^{\\underline{k}} = \\mathbf{1}[\\text{event time} \\leq \\underline{k}]\\) and \\(D_{it}^{\\bar{k}} = \\mathbf{1}[\\text{event time} \\geq \\bar{k}]\\)</li> </ul>"},{"location":"theory/background/#distributed-lag-model","title":"Distributed Lag Model","text":"<p>The DLM regresses the outcome on leads and lags of the treatment indicator:</p> \\[y_{it} = \\alpha_i + \\lambda_t + \\sum_{j=0}^{|\\underline{k}|-1} \\gamma_j^{\\text{lead}} \\cdot x_{i,t+j} + \\sum_{j=0}^{\\bar{k}} \\gamma_j^{\\text{lag}} \\cdot x_{i,t-j} + \\varepsilon_{it}\\] <p>where \\(x_{it}\\) is the treatment variable. In the binary case, \\(x_{it}\\) is an indicator (1 if post-treatment, 0 otherwise). In the generalized case, \\(x_{it}\\) can be a continuous measure of treatment intensity (e.g., a tax rate).</p> <p>This produces gamma (\\(\\gamma\\)) coefficients on the individual leads and lags.</p>"},{"location":"theory/background/#the-equivalence","title":"The Equivalence","text":"<p>Theorem (Schmidheiny &amp; Siegloch 2023): The gamma coefficients from the DLM and the beta coefficients from the binned event study are linked by cumulative summation:</p>"},{"location":"theory/background/#before-the-reference-period","title":"Before the reference period","text":"<p>For \\(k &lt; k^*\\):</p> \\[\\beta_k = -\\sum_{j=k}^{k^*-1} \\gamma_j\\] <p>(negative reverse cumulative sum of gammas from \\(k\\) to the period just before the reference)</p>"},{"location":"theory/background/#after-the-reference-period","title":"After the reference period","text":"<p>For \\(k &gt; k^*\\):</p> \\[\\beta_k = \\sum_{j=k^*+1}^{k} \\gamma_j\\] <p>(forward cumulative sum of gammas from just after the reference to \\(k\\))</p>"},{"location":"theory/background/#standard-error-propagation","title":"Standard Error Propagation","text":"<p>Because betas are cumulative sums of gammas, the standard errors must account for covariances. For a cumulative sum \\(\\beta = \\sum_{j=a}^{b} \\gamma_j\\):</p> \\[\\text{SE}(\\beta) = \\sqrt{\\mathbf{1}' \\cdot V_{a:b, a:b} \\cdot \\mathbf{1}}\\] <p>where \\(V\\) is the variance-covariance matrix of the gammas and \\(\\mathbf{1}\\) is a conformable vector of ones. This correctly accounts for the correlation between adjacent gamma estimates.</p> <p>Not just the sum of SEs</p> <p>A common mistake is computing \\(\\text{SE}(\\beta) = \\sqrt{\\sum \\text{SE}(\\gamma_j)^2}\\), which ignores off-diagonal covariances and produces incorrect confidence intervals.</p>"},{"location":"theory/background/#why-use-the-dlm","title":"Why Use the DLM?","text":""},{"location":"theory/background/#generalization-to-continuous-treatments","title":"Generalization to continuous treatments","text":"<p>The canonical event study relies on event-time indicator variables \u2014 dummies for \"3 periods before treatment,\" \"2 periods before,\" etc. These indicators only make sense when treatment is a one-time binary switch (e.g., a policy turns on and stays on). But many empirical settings involve treatments that are continuous, vary in intensity, change sign, or occur multiple times per unit. For instance:</p> <ul> <li>Multiple tax reforms of different magnitudes hitting different states at different times (Fuest et al., 2018; Su\u00e1rez Serrato &amp; Zidar, 2016)</li> <li>Minimum wage changes that increase by different amounts across jurisdictions (Cengiz et al., 2019)</li> <li>Policy shocks where the treatment variable is inherently continuous (e.g., benefit duration in weeks, tax rates in percentage points)</li> </ul> <p>In these settings, event-time dummies do not apply. Researchers who want to use a canonical event study must typically dichotomize the continuous treatment into \"big changes\" vs. no change \u2014 discarding treatment variation, potentially biasing estimates, and fundamentally changing the analysis (Schmidheiny &amp; Siegloch 2023, Section 4.3).</p> <p>The DLM avoids this problem entirely. Because it regresses on leads and lags of the treatment variable directly, the treatment variable \\(T_{i,t}\\) can be continuous. Treatment effects are interpreted as the effect of a one-unit increase, just as in a generalized difference-in-differences model. This allows researchers to produce event-study-style dynamic treatment effect plots for treatments that increase and decrease at different magnitudes over many time periods.</p>"},{"location":"theory/background/#equivalence-to-binned-event-studies","title":"Equivalence to binned event studies","text":"<p>When applied to the special case of a one-time binary absorbing treatment, the DLM produces point estimates and standard errors that are numerically identical to a properly specified event study with binned endpoints. The DLM is a reparametrization of the event study: the gamma coefficients measure incremental changes in treatment effects, while the beta coefficients (recovered by cumulative summation) measure cumulative treatment effects (Schmidheiny &amp; Siegloch 2023, Remark 6). The DLM is therefore a strict generalization of the canonical event study.</p>"},{"location":"theory/background/#data-requirements-trade-off","title":"Data requirements (trade-off)","text":"<p>The DLM is more data hungry than a canonical event study. Because the model includes leads and lags of the treatment variable, researchers must observe the treatment variable over a wider time window than the outcome variable. Specifically, for a balanced panel observed from period \\(t\\) to \\(\\bar{t}\\) with an event window \\([\\underline{k}, \\bar{k}]\\), the treatment variable must be observed from \\(t - \\bar{k}\\) to \\(\\bar{t} + |\\underline{k}| - 1\\) (Schmidheiny &amp; Siegloch 2023, Remark 4). Observations at the edges of the panel where leads or lags cannot be constructed are automatically dropped from the estimation sample.</p> <p>This means that wider event windows require substantially more data. At some point, the estimation sample becomes too small for precise estimation. Researchers should experiment with different event window lengths and verify that estimates leading up to the endpoints converge, as recommended by Schmidheiny &amp; Siegloch (2023, Remark 3).</p>"},{"location":"theory/background/#verification","title":"Verification","text":"<p>Both the R and Stata implementations include equivalence tests that verify DLM betas match event-study betas to machine precision (~10\u207b\u00b9\u00b3). The cross-language test confirms the R and Stata implementations agree to ~10\u207b\u2078 (the small difference is due to different HDFE solvers: <code>fixest</code> in R vs. <code>reghdfe</code> in Stata).</p>"},{"location":"theory/background/#reference","title":"Reference","text":"<p>Schmidheiny, K. and S. Siegloch (2023). \"On event studies and distributed-lag models: Equivalence, generalization and practical implications.\" Journal of Applied Econometrics, 38(5): 695\u2013713. DOI: 10.1002/jae.2971</p>"}]}